## CFS-M_phase-PolQ-2023

Folder CFS-M_phase-PolQ-2023 carries job scripts, log file outputs,
and other data resources related to 
[Wilson et al. 2024](pending),
which describes the 
application of svCapture to discover that structural variants at commmon fragile site are created by end joining in M phase.

## Source publication

For more information, please see and cite:

**POLQ mediates replication-stress induced structural variant 
formation throughout common fragile sites during mitosis
.**<br>
Thomas E Wilson, Samreen Ahmed, Pamela Bennett-Baker, Thomas W Glover.<br>
[_Molecular Cell_](), 
submitted.<br>
[PMID: pending](), 
[PMCID: pending]()

## Associated sequencing data sets

The sequencing data sets in the above publication are available via SRA as follows:
- cell lines HCT116 and GM12878 (unrestricted): [BioProject PRJNA1085257](https://www.ncbi.nlm.nih.gov/bioproject/?term=PRJNA1085257)
- cell line HF1 (restricted), [BioProject PRJNA903514](https://www.ncbi.nlm.nih.gov/bioproject/?term=PRJNA903514): [dbGaP study phs003121](https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/study.cgi?study_id=phs003121.v2.p1)


Some are restricted human samples for which you 
will need download permissions from dbGaP.

## Required code suite and genome files

The svCapture pipeline and app are implemented in this Michigan Data Interface tool suite:
- repository: <https://github.com/wilsontelab/svx-mdi-tools>
- documentation: <https://wilsontelab.github.io/svx-mdi-tools>

Please follow the documentation instructions to install the required code and hg38 genome. 

## Resource files

The **resources** folder has additional supporting data files required
to run the svCapture pipeline actions:

| File        | Description |
| ----------- | ----------- |
| HF1_capture_targets.hg38.bed  | the three 250kb regions targeted for capture in HF1 cells |
| targets_UM_Wilson_chr3_chr16_TE-93195434_hg38.bed | the two 400kb regions targeted for capture in HCT116 and GM12878 cells | 

## Pipeline jobs as we ran them

This section summarizes the job configuration files and output logs as we ran them for the work reported in the paper.

### Sample lists

Folder **sample_lists** has csv format files with the names and experimental conditions of all 
samples analyzed by svCapture, stratified by cell line. Samples are organized by "project",
where a project is a batch of samples submitted for sequencing and analyzed together at a specific time.

The master table of all samples from all cell lines is:
- sample_lists/CFS-M_phase-PolQ-2023.csv

Script `split_by_cell_line.R` was used to split that master table into
individual tables per cell line (leading to a total of four downstream assemblies):
- sample_lists/CFS-M_phase-PolQ-2023_GM12878.csv
- sample_lists/CFS-M_phase-PolQ-2023_HCT116.csv
- sample_lists/CFS-M_phase-PolQ-2023_HF1.csv

### Job configuration scripts

Folder **find_by_project** has subfolders for each analyzed cell line,
each carrying YAML-format job configuration scripts for the experimental projects
listed in the **samples_lists** folder, one YAML file per project.

Folder **assemble_all_projects** has YAML-format job configuration scripts
used to make composite output files of all analyzed projects and samples by cell line
(file `assemble.yml`) or all cell lines together (file `assemble_all.yml`).
The output assembly data packages
were loaded into the svCaptureAssembly app for plotting most figures (see below).

These folders additionally carry files
named `svCapture.yml` that provide environment-level parameters for 
job configuration applied to all job files in the folder.

### Job output logs

Folder **job_reports** has subfolders matching the `find` and `assemble`
job script organization. For every YAML-format job configuration script
described above you will find a file `<name>.report_all.txt` which contains the 
output of commands equivalent to (although only the last, definitive job
log is reported in job_reports):

```
mdi <name>.yml status > <name>.report_all.txt
mdi <name>.yml report -j all >> <name>.report_all.txt
```

The composite log file thus begins with a summary of the 
jobs that were executed followed by 
all primary pipeline job logs. Information in the logs includes software versions, summary statistics, and other information
reported by program dependencies and our job scripts.

## Assembly data packages and app bookmarks for interactive plotting

The following Zenodo data set, available for public download:
- <https://zenodo.org/doi/10.5281/zenodo.10916987>

carries the assembly data packages generated by the jobs above,
as well as a collection of MDI app bookmark files
for the `svx-mdi-tools/svCaptureAssembly` app. These bookmarks recorded the 
state of the app as we used it to create most svCapture figures in the publication. 

To remake plots yourself and explore additional plot variations:

- [install the MDI](https://midataint.github.io/docs/installation/00_index/) to run R Shiny apps (also see the svx-mdi-tools documentation above)
- load a bookmark file from the `app_bookmarks` folder of the Zenodo data set above
- load the required data package(s) from the `data_packages` folder of the Zenodo data set above using appStep `1-Adjust Sample Sources`
- click a saved Assembly Plot configuration using appStep `2-Assemble Plots`

After loading a plot configuration, expand one of the output plot types
in the boxes below and click `Allow Data Processing` to allow the plot to 
be calculated and rendered.

You can also start anew by selecting an `Assembly Set` from the table
and adjusting the data to be plotted under `Plot Settings`.

Detailed use of the plotting interface is beyond the scope of these instructions.
Briefly, use lists to the left of a plot output to select
experimental conditions and groups to include on the plot.
Additional plot settings are available under the gear/cog icon on the plot box.

Please contact us if you would like additional guidance using the plotting interface after you have it loaded and started working with it.
